!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=21)}({21:function(e,t,r){"use strict";var n={},a={useTooltip:"true",useTTS:"false",translateSource:"auto",translateTarget:navigator.language,translatorVendor:"google",keyDownTooltip:"null",keyDownTTS:"null",detectType:"sentence",translateReverseTarget:"null",tooltipFontSize:"14",tooltipWidth:"200",useOCR:"false",ocrDetectionLang:"jpn_vert",historyList:[],historyRecordActions:[]},o={auto:"auto-detect",af:"af",am:"am",ar:"ar",az:"az",bg:"bg",bs:"bs",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fr:"fr",ga:"ga",gu:"gu",hi:"hi",hmn:"mww",hr:"hr",ht:"ht",hu:"hu",hy:"hy",id:"id",is:"is",it:"it",iw:"he",ja:"ja",kk:"kk",km:"km",kn:"kn",ko:"ko",ku:"ku",lo:"lo",lt:"lt",lv:"lv",mg:"mg",mi:"mi",ml:"ml",mr:"mr",ms:"ms",mt:"mt",my:"my",ne:"ne",nl:"nl",no:"nb",pa:"pa",pl:"pl",ps:"ps",pt:"pt",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sm:"sm",sq:"sq",sr:"sr-Cyrl",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tl:"fil",tr:"tr",uk:"uk",ur:"ur",vi:"vi","zh-cn":"zh-Hans","zh-tw":"zh-Hant"};var s=function(e){var t={};for(var r in e)t[e[r]]=r;return t}(o);function l(e){chrome.storage.local.set(e,(function(){n=e}))}let i;chrome.runtime.onMessage.addListener((function(e,t,r){return(async()=>{n=await new Promise((e,t)=>{Object.keys(n).length!=Object.keys(a).length?chrome.storage.local.get(Object.keys(a),(function(t){for(var r in a)t[r]?n[r]=t[r]:n[r]=a[r];e(n)})):e(n)}),"translate"===e.type?async function(e,t){var r,a,l="",c="";if("google"==n.translatorVendor)r="https://translate.googleapis.com/translate_a/t?client=dict-chrome-ex&",a={q:e.word,sl:n.translateSource,tl:e.translateTarget};else{(!i||Date.now()-i.tokenTs>i.tokenExpiryInterval)&&(i=await async function(){try{const e=await fetch("https://www.bing.com/translator").then(e=>e.text()),t=e.match(/IG:"([^"]+)"/)[1],r=e.match(/data-iid="([^"]+)"/)[1],[n,a,o,s,l]=JSON.parse(e.match(/params_RichTranslateHelper\s?=\s?([^\]]+\])/)[1]);return{IG:t,IID:r,key:n,token:a,tokenTs:n,tokenExpiryInterval:o,isAuthv2:void 0,count:0}}catch(e){console.log(e)}}()),r="https://www.bing.com/ttranslatev3?isVertical=1&&";const{token:t,key:s,IG:l,IID:c}=i;a={text:e.word,fromLang:o[n.translateSource],to:o[e.translateTarget],token:t,key:s,IG:l,IID:c&&c.length?c+"."+i.count++:""}}try{const o=await fetch(r+new URLSearchParams(a),{method:"POST"}).then(e=>e.json());"google"==n.translatorVendor?(o.sentences&&o.sentences.forEach((function(e){e.trans&&(c+=e.trans)})),l=o.src):(l=s[o[0].detectedLanguage.language],c=o[0].translations[0].text),t({translatedText:c,sourceLang:l,targetLang:e.translateTarget})}catch(r){console.log(r),t({translatedText:"",sourceLang:"en",targetLang:e.translateTarget})}}(e,r):"tts"===e.type?(chrome.tts.getVoices(t=>{let r=t.filter(e=>null!=e.remote&&null!=e.lang&&null!=e.voiceName);for(var n of(r.sort((e,t)=>t.remote-e.remote),r))if(n.lang.toLowerCase().includes(e.lang.toLowerCase())){chrome.tts.speak(e.word,{lang:e.lang,voiceName:n.voiceName});break}}),r({})):"stopTTS"===e.type?(chrome.tts.stop(),r({})):"saveSetting"===e.type?l(e.options):"loadSetting"===e.type?r(n):"recordHistory"===e.type&&(n.historyList.unshift({sourceText:e.sourceText,targetText:e.targetText}),n.historyList.length>100&&n.historyList.pop(),l(n))})(),!0})),chrome.webRequest.onHeadersReceived.addListener(({url:e,method:t,responseHeaders:r})=>{const n=r.filter(e=>"content-disposition"===e.name.toLowerCase()).shift();if(n&&n.value.toLowerCase().includes("attachment"))return;const a=r.filter(e=>"content-type"===e.name.toLowerCase()).shift();a&&a.value.toLowerCase().includes("application/pdf")&&chrome.tabs.update({url:chrome.runtime.getURL("/pdfjs/web/viewer.html")+"?file="+e})},{urls:["<all_urls>"],types:["main_frame","sub_frame"]},["responseHeaders"]),chrome.webRequest.onBeforeRequest.addListener((function({url:e,method:t}){chrome.tabs.update({url:chrome.runtime.getURL("/pdfjs/web/viewer.html")+"?file="+e})}),{urls:["file:///*/*.pdf","file:///*/*.PDF"],types:["main_frame"]},[])}});
//# sourceMappingURL=background.js.map